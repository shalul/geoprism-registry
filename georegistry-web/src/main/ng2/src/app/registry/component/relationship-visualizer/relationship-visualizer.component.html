<div id="relationship-visualizer-root-node" *ngIf="geoObject"
    style="overflow: hidden; z-index:5; overflow: hidden;"
    [ngStyle]="{ 'width': ((graphPanelOpen && !searchPanelOpen) ? '50%' : 'unset'), 'top': graphPanelOpen ? '0px' : '30px', 'left': graphPanelOpen ? '0px' : '10px', 'right': graphPanelOpen ? (searchPanelOpen ? '8px' : 'unset') : 'unset', 'bottom': graphPanelOpen ? '10px' : 'unset', 'overflow': graphPanelOpen ? 'hidden' : 'visible' }">

  <ngx-spinner [fullScreen]="false" [name]="CONSTANTS.OVERLAY" type="ball-clip-rotate-multiple" size="medium"></ngx-spinner>  

  <span class="map-button visualize-mode-toggle" [ngStyle]="{ 'top': graphPanelOpen ? '30px' : '0px', 'left': graphPanelOpen ? '10px' : '0px' }">
    <i style="margin-right: initial" class="visualize-mode-hierarchy clickable fa fa-share-alt" aria-hidden="true" (click)="toggleSize($event)" [title]="(graphPanelOpen ? 'explorer.resize.closeGraphViz' : 'explorer.resize.openGraphViz') | localize"></i>
  </span>

  <div *ngIf="graphPanelOpen" class="new-admin-design-main" style="overflow-y:hidden; position: absolute; left: 65px; top: 5px; right: 0px; border-radius:4px;">
  
    <div style="height:100%; width:100%; background-color: white; opacity: 100%" class="container-fluid">
  
      <select *ngIf="relationships" id="relationshipId" name="relationshipId" class="select-area" [(ngModel)]="graphOid" (change)="onSelectRelationship()" required
              style="margin-top: 5px;"
      >
        <option></option>

         <option *ngFor="let loopRel of relationships" [value]="loopRel.oid">{{loopRel.label.localizedValue}}</option>
      </select>
      
      <div *ngIf="relationships" style="height:100%; width:100%;" class="row">
  
        <div class="hierarchy-content" style="height:100%; width:100%;">
          <div id="graph-container" style="height:100%; width:100%;">
            <ngx-graph *ngIf="data"
              class="chart-container"
              [view]="[svgWidth, svgHeight]"
              [links]="data.edges"
              [nodes]="data.verticies"
              [animate]="true"
              [autoZoom]="true"
              [autoCenter]="true"
              [layout]="layout"
              [layoutSettings]="{orientation: relationship.isHierarchy ? CONSTANTS.ORIENTATION.TOP_TO_BOTTOM : CONSTANTS.ORIENTATION.LEFT_TO_RIGHT}"
              [curve]="curve"
              [draggingEnabled]="false"
              [panToNode$]="panToNode$"
              [update$]="update$"
            >
              <!-- Draw an arrow on relationships for directed graph types -->
              <ng-template #defsTemplate>
                <ng-container *ngIf="relationship.type !== 'UndirectedGraphType'">
                  <svg:marker id="arrow" viewBox="0 -5 10 10" refX="8" refY="0" markerWidth="4" markerHeight="4" orient="auto">
                    <svg:path d="M0,-5L10,0L0,5" class="arrow-head" />
                  </svg:marker>
                </ng-container>
              </ng-template>

              <!-- Node Template -->
              <ng-template #nodeTemplate let-node>
                <svg:g (click)="onClickNode(node)" class="node">
                  <svg:polygon [attr.points]="getHexagonPoints(node)"
                    [attr.fill]="geoObject == null ? node.data.color : (('g-' + geoObject.properties.uid) === node.id ? '#4287f5' : 'gray')"
                  ></polygon>
                  
	                <foreignObject
	                        [attr.x]="relationship.isHierarchy ? (node.relation === 'CHILD' ? 0 : (this.DIMENSIONS.LABEL.WIDTH + DIMENSIONS.PADDING.NODE_LABEL + this.DIMENSIONS.NODE.WIDTH) / 2 + this.DIMENSIONS.NODE.WIDTH / 2 + DIMENSIONS.PADDING.NODE_LABEL) : (node.relation === 'PARENT' ? -DIMENSIONS.PADDING.NODE_LABEL : (node.relation === 'SELECTED' ? 15 : (DIMENSIONS.NODE.WIDTH + DIMENSIONS.PADDING.NODE_LABEL)))"
	                        [attr.y]="relationship.isHierarchy ? (node.relation === 'CHILD' ? DIMENSIONS.NODE.HEIGHT + DIMENSIONS.PADDING.NODE_LABEL: 0) : node.relation === 'SELECTED' ? -10 : 0"
	                        [attr.width]="DIMENSIONS.LABEL.WIDTH" [attr.height]="DIMENSIONS.LABEL.HEIGHT">
	                    <span [style]="'width:' + DIMENSIONS.LABEL.WIDTH + 'px; height:' + DIMENSIONS.LABEL.HEIGHT + 'px; overflow:hidden; display: inline-block;'">
	                      <p xmlns="http://www.w3.org/1999/xhtml" text-anchor="start" [ngStyle]="{'text-align': relationship.isHierarchy ? (node.relation === 'CHILD' ? 'center' : 'left') : node.relation === 'SELECTED' ? 'center' : (node.relation === 'PARENT' ? 'right' : 'left')}" [style]="'font-size: ' + DIMENSIONS.LABEL.FONTSIZE + 'px; display: table-cell; vertical-align: middle; height:' + DIMENSIONS.LABEL.HEIGHT + 'px; width:' + DIMENSIONS.LABEL.WIDTH + 'px; line-height:' + DIMENSIONS.LABEL.FONTSIZE + 'px;'">{{node.label}}</p>
	                    </span>
	                </foreignObject>
                </svg:g>
              </ng-template>

              <!-- Link Template -->
              <ng-template #linkTemplate let-link>
                <svg:g class="edge">
                  <svg:path class="line" stroke-width="2" marker-end="url(#arrow)"></svg:path>
                </svg:g>
              </ng-template>
            </ngx-graph>
          </div>
        </div>
      </div>
    </div>
  
  </div>

</div>
