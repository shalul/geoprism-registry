<ng-template #customItemTemplate let-model="item" let-index="index">
	<h5>{{model.name }} : {{ model.code }}</h5>
	<h6>
		{{model.layer.label}} - {{ model.layer.forDate }} ( <span *ngIf="model.layer.versionNumber !== 0"> <localize
				key="list.type.version"></localize> {{model.layer.versionNumber}}
		</span>
		<localize *ngIf="model.layer.versionNumber === 0" key="list.type.working.version"></localize>
		)
	</h6>
</ng-template>


<cgr-header></cgr-header>
<loading-bar></loading-bar>


<div id="app-container" class="container-fluid">

	<!-- Floating search panel-->
	<div style="position: absolute; top: 0; bottom: 0; left: 10px; right: 10px; height: 100%;">
		<div class="row" style="margin-top: 50px;">
		
			<div class="col-md-4" style="z-index: 999;" [hidden]="!showPanel">
				<div class="row" *ngIf="searchEnabled">
					<!-- 
                    		Search features from the working versions of lists
                	-->
                	<article class="panel-toggle" [ngClass]="{'detached' : data.length === 0 && !record}">
						<ng-container>
<!-- 							<div class="col-md-4"> -->
<!-- 								<date-field [(value)]="state.date" label="" [inputName]="'date'" [allowInfinity]="false" -->
<!-- 									[allowFutureDates]="false" [required]="false" [placement]="'right'" style="display:inline-grid;"> </date-field> -->
<!-- 							</div> -->
							<div class="col-md-12" >
								
								<div class="input-group">
								<date-field [(value)]="state.date" label="" [inputName]="'date'" [allowInfinity]="false"
									[allowFutureDates]="false" [required]="false" [placement]="'right'" style="display:table-cell;vertical-align:middle;width:175px;"> </date-field>
									
									<input type="text" class="form-control" [placeholder]="'explorer.search.placeholder' | localize"
										(keyup.enter)="search()" [(ngModel)]="state.text" name="text"> <span class="input-group-btn">
										<button [disabled]="isEdit" class="btn btn-primary" type="button" (click)="search()">
											<span class="glyphicon glyphicon-search" aria-hidden="true"></span>
										</button>
									</span>
								</div>
							</div>
						</ng-container>
					</article>
				</div>

				<div class="row">
					<div class="col-md-12">
						<ng-container *ngIf="mode === MODE.SEARCH && searchEnabled">
							<div class="row">
								<div class="col-md-12" [ngClass]="{'full-height-sidebar' : data.length > 0 }">
									<div id="hierarchy-tree-container" class="location-management-widget-section location-management-list-container">
										<div class="list-group">
		
											<div *ngFor="let node of data; let i = index" class="list-group-item">
												<div class="card card-default" (click)="select(node, $event)">
													<div class="card-body">
													  <!--
						                              <i class="fa fa-map-marker clickable" style="float:right;font-size:25px;" aria-hidden="true"
						                                (click)="zoomToFeature(node, $event)" [title]="'explorer.zoom.label' | localize"></i>
						                              <i class="fa fa-sitemap clickable" style="float:right;font-size:25px;" aria-hidden="true" (click)="visualizeRelationships(node, VISUALIZE_MODE.GRAPH, $event)" [title]="'hierarchyVisualizer.tooltip' | localize"></i>
						                              -->
														<h4 class="clickable" style="word-break: break-all;" title="View Geo-Object details">
															{{node.properties.code}} - {{node.properties.displayLabel.localizedValue}}</h4>
													</div>
												</div>
											</div>
		
										</div>
									</div>
								</div>
							</div>
						</ng-container>
	
						<ng-container *ngIf="mode === MODE.VIEW && record != null">
							<div *ngIf="record.recordType === 'GEO_OBJECT'" class="row">
								<div class="col-md-12" [ngClass]="{'full-height-sidebar' : record, 'max-height' : !searchEnabled }">
									<feature-panel #FeaturePanel [type]="record.type" [code]="record.code" [forDate]="record.forDate"
										(forDateChange)="featurePanelForDateChange($event)" [readOnly]="false" (modeChange)="onModeChange($event)"
										(panelCancel)="clearRecord()" (panelSubmit)="onPanelSubmit($event)"> </feature-panel>
								</div>
							</div>
							<div *ngIf="record.recordType === 'LIST'" class="row">
								<div class="col-md-12" [ngClass]="{'full-height-sidebar' : record}">
									<record-panel [record]="record" (close)="clearRecord()"></record-panel>
								</div>
							</div>
						</ng-container>
					</div>
				</div>
				
			</div> <!--  END sidebar panel -->
	
			<div [ngClass]="{'col-md-6':!showPanel, 'col-md-8':showPanel}" style="z-index:4;padding-top:10px;">
			
				<div style="z-index:999;padding-top:10px;overflow-y:auto;position:absolute;top:0;overflow:visible;">
					<div *ngIf="searchEnabled || record" class="map-button clickable" style="padding-bottom: 5px;" (click)="!isEdit && togglePanel()">
						<div class="map-button-icon">
							<span class="fa clickable" style="font-size: 35px;"
								[title]="(showPanel ? 'explorer.resize.closeAttributePanel' : 'explorer.resize.openAttributePanel') | localize"
								[ngClass]="{'fa-angle-double-left': showPanel, 'fa-angle-double-right': !showPanel}" aria-hidden="true">
							</span>
						</div>
					</div>
					<span *ngIf="current && graphVisualizerEnabled" class="map-button visualize-mode-toggle"> 
						<i style="margin-right: initial" class="visualize-mode-hierarchy clickable fa fa-share-alt" aria-hidden="true"
						[title]="(graphPanelOpen ? 'explorer.resize.closeGraphViz' : 'explorer.resize.openGraphViz') | localize"
						(click)="toggleGraphPanel()"></i>
					</span>
				</div>
				
				<div *ngIf="graphPanelOpen" id="graph-container" style="height: calc(100vh - 74px);padding-left: 58px;">
					<div style="background-color: white; opacity: 100%; width: 100%; height: 100%;">
						<relationship-visualizer *ngIf="record && record.recordType === 'GEO_OBJECT'"
							[params]="{geoObject: current, graphOid: visualizingRelationship, date: calculatedDate}" [panelOpen]="showPanel"
							(changeGeoObject)="onChangeGeoObject($event)" (changeRelationship)="visualizingRelationship = $event">
						</relationship-visualizer>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Full screen map-->
	<div class="row">
		<div class="col-md-12">
			<div class="row">
				
				<article id="navigator-layer-panel" class="base-layer-panel"
					[ngClass]="{'second-map-button' : searchEnabled && !showPanel}"
					[ngStyle]="{'max-width': layersPanelSize === 2 ? '50%' : 'unset', 'padding-left': layersPanelSize === 2 ? '10px' : 'unset'}">
					<layer-panel (layerChange)="onLayerChange($event)" (reorder)="onReorderLayers($event)"
						(zoomTo)="onZoomTo($event.oid)" (create)="onCreate($event)" [panelSize]="layersPanelSize"
						[includeGraphLayer]="data != null && data.length > 0"> </layer-panel>
				</article>

				<div id="map" class="map-view-port"></div>

			</div>
		</div>
	</div>
</div>