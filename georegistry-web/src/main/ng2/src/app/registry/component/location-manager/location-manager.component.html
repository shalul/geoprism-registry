<ng-template #customItemTemplate let-model="item" let-index="index">
  <h5>{{model.name }} : {{ model.code }}</h5>
  <h6>
    {{model.layer.label}} - {{ model.layer.forDate }}
    (
    <span *ngIf="model.layer.versionNumber !== 0">
      <localize key="list.type.version"></localize>
      {{model.layer.versionNumber}}
    </span>
    <localize *ngIf="model.layer.versionNumber === 0" key="list.type.working.version"></localize>
    )
  </h6>
</ng-template>


<div class="">
  <cgr-header></cgr-header>
  <loading-bar></loading-bar>


  <div id="app-container" class="container-fluid">
  
    <div *ngIf="searchEnabled" class="row" style="position: absolute;top: 0;bottom: 0;left: 10px;right: 10px;height: 100%;">
        <div class="col-md-4" style="z-index:999;padding-bottom: 10px;" [style.background]="showPanel ? 'white' : 'transparent'">
        
          <article class="panel-toggle" *ngIf="showPanel">
            
            <div >
              <div class="row">
                  <div class="col-md-12">
                      <label class="radio" style="display:inline-block;">
                        <input type="radio" name="userActive" [value]="false" [(ngModel)]="searchFeatures">
                        <span><localize key="explorer.search.search.graph"></localize></span>
                      </label>
                      <label class="radio" style="display:inline-block;margin-left:10px;">
                        <input type="radio" name="userActive" [value]="true" [(ngModel)]="searchFeatures" [disabled]="(layers.length < 1)">
                        <span><localize key="explorer.search.search.map.features"></localize></span>
                      </label>
                  </div>
              </div>
              <div class="row">
                <!-- 
                    Search features from the working versions of lists
                -->
                <ng-container *ngIf="searchEnabled && !searchFeatures">
                  <div class="col-md-4">
                    <date-field [(value)]="state.date" label="" [inputName]="'date'" [allowInfinity]="false"
                      [allowFutureDates]="false" [required]="false" [placement]="'right'" style="display:inline-grid;">
                    </date-field>
                  </div>
                  <div class="col-md-8">
                    <div class="input-group">
                      <input type="text" class="form-control" [placeholder]="'explorer.search.placeholder' | localize"
                        (keyup.enter)="search()" [(ngModel)]="state.text" name="text">
                      <span class="input-group-btn">
                        <button [disabled]="isEdit" class="btn btn-primary" type="button" (click)="search()">
                          <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                        </button>
                      </span>
                    </div>
                  </div>
                </ng-container>
      
                <!-- 
                    Search features that are rendered in the map 
                -->
                <ng-container *ngIf="searchFeatures">
                  <div class="col-md-12">
                    <div>
                      <input type="text" class="form-control" placeholder="Search features" [(ngModel)]="state.featureText"
                        name="featureText" [disabled]="isEdit" [typeaheadAsync]="true" [typeahead]="typeahead"
                        [typeaheadItemTemplate]="customItemTemplate" (typeaheadOnSelect)="onFeatureSelect($event)"
                        [typeaheadMinLength]="1" [typeaheadWaitMs]="300" [typeaheadOptionsLimit]="20">
                    </div>
                  </div>
                </ng-container>
      
              </div>
            </div>
          </article>
      </div>
    </div>

    <div class="row">
      <div *ngIf="showPanel" id="navigator-left-sidebar" class="col-md-4 lw-inner-col"
        style="height: calc(100vh - 144px);overflow-y: auto;">

        <ng-container *ngIf="mode === MODE.SEARCH && searchEnabled">

          <div class="row">
            <div class="col-md-12">
              <div id="hierarchy-tree-container"
                class="location-management-widget-section location-management-list-container">
                <div class="list-group">

                  <div *ngFor="let node of data; let i = index" class="list-group-item">
                    <div class="card card-default" (click)="select(node, $event)">
                      <div class="card-body">
                        <!--
                        <i class="fa fa-map-marker clickable" style="float:right;font-size:25px;" aria-hidden="true"
                          (click)="zoomToFeature(node, $event)" [title]="'explorer.zoom.label' | localize"></i>
                        <i class="fa fa-sitemap clickable" style="float:right;font-size:25px;" aria-hidden="true" (click)="visualizeRelationships(node, VISUALIZE_MODE.GRAPH, $event)" [title]="'hierarchyVisualizer.tooltip' | localize"></i>
                        -->
                        <h4 class="clickable" style="word-break: break-all;" title="View Geo-Object details">
                          {{node.properties.code}} - {{node.properties.displayLabel.localizedValue}}</h4>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <ng-container *ngIf="mode === MODE.VIEW && record != null">
          <div *ngIf="record.recordType === 'GEO_OBJECT'" class="row">
            <div class="col-md-12">
              <feature-panel [type]="record.type" [code]="record.code" [forDate]="record.forDate" (forDateChange)="featurePanelForDateChange($event)" [readOnly]="false"
                (modeChange)="onModeChange($event)" (panelCancel)="clearRecord()" (panelSubmit)="onPanelSubmit($event)">
              </feature-panel>
            </div>
          </div>
          <div *ngIf="record.recordType === 'LIST'" class="row">
            <div class="col-md-12">
              <record-panel [record]="record" (close)="clearRecord()"></record-panel>
            </div>
          </div>
        </ng-container>
      </div>

      <div [ngClass]="{'col-md-8':showPanel, 'col-md-12':!showPanel}" >
        <div class="row">

          <article id="navigator-layer-panel" class="base-layer-panel" [ngClass]="{'second-map-button' : searchEnabled && !showPanel}" [ngStyle]="{'max-width': layersPanelSize === 2 ? '50%' : 'unset', 'padding-left': layersPanelSize === 2 ? '10px' : 'unset'}">
            <layer-panel (layerChange)="onLayerChange($event)" (reorder)="onReorderLayers($event)"
              (zoomTo)="onZoomTo($event.oid)" (create)="onCreate($event)" [panelSize]="layersPanelSize"
              [includeGraphLayer]="data != null && data.length > 0">
            </layer-panel>
          </article>

          <div id="map" class="map-view-port"></div>

        </div>
        
        <div class="map-button clickable" (click)="!isEdit && togglePanel()" style="position: absolute; top: 0; left: 10px;">
          <div class="map-button-icon">
            <span class="fa" [title]="(showPanel ? 'explorer.resize.closeAttributePanel' : 'explorer.resize.openAttributePanel') | localize" [ngClass]="{'fa-angle-double-left': showPanel, 'fa-angle-double-right': !showPanel}" aria-hidden="true"></span>
          </div>
        </div>
        
        <relationship-visualizer *ngIf="record && record.recordType === 'GEO_OBJECT'"
          [params]="{geoObject: current, graphOid: visualizingRelationship, date: calculatedDate, searchPanelOpen: showPanel}"
          (changeGeoObject)="onChangeGeoObject($event)"
          (changeRelationship)="visualizingRelationship = $event"
          [graphPanelOpen]="graphPanelOpen"
        >
        
        </relationship-visualizer>
	      
	      <!--
	      <div *ngIf="visualizeMode === VISUALIZE_MODE.GRAPH && current" style="height: calc(100vh - 145px);" class="row">
	        <graph-visualizer
	          [geoObject]="current"
	          (changeGeoObject)="onChangeGeoObject($event)"
	        >
	        
	        </graph-visualizer>
	      </div>
	      -->
      </div>
    </div>
  </div>
</div>