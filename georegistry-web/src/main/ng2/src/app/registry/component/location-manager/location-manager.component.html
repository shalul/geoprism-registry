<ng-template #customItemTemplate let-model="item" let-index="index">
  <h5>{{model.name }} : {{ model.code }}</h5>
  <h6>
    {{model.layer.label}} - {{ model.layer.forDate }}
    (
    <span *ngIf="model.layer.versionNumber !== 0">
      <localize key="list.type.version"></localize>
      {{model.layer.versionNumber}}
    </span>
    <localize *ngIf="model.layer.versionNumber === 0" key="list.type.working.version"></localize>
    )
  </h6>
</ng-template>


<div class="">
  <cgr-header></cgr-header>
  <loading-bar></loading-bar>


  <div id="app-container" class="container-fluid">

    <!-- Floating search panel-->
    <div style="position: absolute;top: 0;bottom: 0;left: 10px;right: 10px;height: 100%;">
      <div class="row" style="margin-top: 140px;">
        <div class="col-md-4" style="z-index:999;padding-bottom: 10px;"
          [style.background]="showPanel ? 'white' : 'transparent'" [hidden]="!showPanel">

          <article class="panel-toggle">

            <div>
              <div class="row">
                <div class="col-md-12">
                  <label class="radio" style="display:inline-block;">
                    <input type="radio" name="userActive" [value]="false" [(ngModel)]="searchFeatures">
                    <span>
                      <localize key="explorer.search.search.graph"></localize>
                    </span>
                  </label>
                  <label class="radio" style="display:inline-block;margin-left:10px;">
                    <input type="radio" name="userActive" [value]="true" [(ngModel)]="searchFeatures"
                      [disabled]="(layers.length < 1)">
                    <span>
                      <localize key="explorer.search.search.map.features"></localize>
                    </span>
                  </label>
                </div>
              </div>
              <div class="row">
                <!-- 
                    Search features from the working versions of lists
                -->
                <ng-container *ngIf="searchEnabled && !searchFeatures">
                  <div class="col-md-4">
                    <date-field [(value)]="state.date" label="" [inputName]="'date'" [allowInfinity]="false"
                      [allowFutureDates]="false" [required]="false" [placement]="'right'" style="display:inline-grid;">
                    </date-field>
                  </div>
                  <div class="col-md-8">
                    <div class="input-group">
                      <input type="text" class="form-control" [placeholder]="'explorer.search.placeholder' | localize"
                        (keyup.enter)="search()" [(ngModel)]="state.text" name="text">
                      <span class="input-group-btn">
                        <button [disabled]="isEdit" class="btn btn-primary" type="button" (click)="search()">
                          <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                        </button>
                      </span>
                    </div>
                  </div>
                </ng-container>

                <!-- 
                    Search features that are rendered in the map 
                -->
                <ng-container *ngIf="searchFeatures">
                  <div class="col-md-12">
                    <div>
                      <input type="text" class="form-control" placeholder="Search features"
                        [(ngModel)]="state.featureText" name="featureText" [disabled]="isEdit" [typeaheadAsync]="true"
                        [typeahead]="typeahead" [typeaheadItemTemplate]="customItemTemplate"
                        (typeaheadOnSelect)="onFeatureSelect($event)" [typeaheadMinLength]="1" [typeaheadWaitMs]="300"
                        [typeaheadOptionsLimit]="20">
                    </div>
                  </div>
                </ng-container>

              </div>
              <ng-container *ngIf="mode === MODE.SEARCH && searchEnabled">

                <div class="row">
                  <div class="col-md-12">
                    <div id="hierarchy-tree-container"
                      class="location-management-widget-section location-management-list-container">
                      <div class="list-group">

                        <div *ngFor="let node of data; let i = index" class="list-group-item">
                          <div class="card card-default" (click)="select(node, $event)">
                            <div class="card-body">
                              <!--
                              <i class="fa fa-map-marker clickable" style="float:right;font-size:25px;" aria-hidden="true"
                                (click)="zoomToFeature(node, $event)" [title]="'explorer.zoom.label' | localize"></i>
                              <i class="fa fa-sitemap clickable" style="float:right;font-size:25px;" aria-hidden="true" (click)="visualizeRelationships(node, VISUALIZE_MODE.GRAPH, $event)" [title]="'hierarchyVisualizer.tooltip' | localize"></i>
                              -->
                              <h4 class="clickable" style="word-break: break-all; margin-bottom: 0;" title="View Geo-Object details">
                                {{node.properties.code}} - {{node.properties.displayLabel.localizedValue}}
                              </h4>
                              <span style="font-size: 10px; color: gray;">
                                {{getGeoObjectTypeLabel(node)}}
                              </span>
                            </div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>

              <ng-container *ngIf="mode === MODE.VIEW && current != null">
                  <div class="col-md-12">
                    <feature-panel #FeaturePanel [type]="current.type" [code]="current.code" [forDate]="current.forDate"
                      (forDateChange)="featurePanelForDateChange($event)" [readOnly]="false"
                      (modeChange)="onModeChange($event)" (panelCancel)="clearRecord()"
                      (panelSubmit)="onPanelSubmit($event)">
                    </feature-panel>
                  </div>
<!--

  <div *ngIf="record.recordType === 'LIST'" class="row">
    <div class="col-md-12">
      <record-panel [record]="record" (close)="clearRecord()"></record-panel>
    </div>
  </div>
-->                
              </ng-container>
            </div>

          </article>
        </div>
        <div class="col-md-1" style="z-index:999;padding-top: 10px;">
          <div class="map-button clickable" style="padding-bottom: 5px;" (click)="!isEdit && togglePanel()">
            <div class="map-button-icon">
              <span class="fa" style="padding-top: 8px;"
                [title]="(showPanel ? 'explorer.resize.closeAttributePanel' : 'explorer.resize.openAttributePanel') | localize"
                [ngClass]="{'fa-angle-double-left': showPanel, 'fa-angle-double-right': !showPanel}"
                aria-hidden="true"></span>
            </div>
          </div>
          <span class="map-button visualize-mode-toggle" *ngIf="graphVisualizerEnabled">
            <i style="margin-right: initial" class="visualize-mode-hierarchy clickable fa fa-share-alt"
              aria-hidden="true"
              [title]="(graphPanelOpen ? 'explorer.resize.closeGraphViz' : 'explorer.resize.openGraphViz') | localize"
              (click)="toggleGraphPanel()"></i>
          </span>
        </div>
        <!--

  <div class="col-md-1" *ngIf="showPanel" style="z-index:999;padding-top: 10px">
  </div>
-->
        <div [ngClass]="{'col-md-5':!showPanel, 'col-md-7':showPanel}" *ngIf="graphPanelOpen && graphVisualizerEnabled && current != null"
          style="z-index:999;padding-top: 10px; overflow-y: auto;">
          <div id="graph-container" style="height: calc(100vh - 164px);">
            <div style="background-color: white; opacity: 100%; width: 100%; height: 100%;">
              <relationship-visualizer
                [params]="{geoObject: current.geoObject, graphOid: visualizingRelationship, date: calculatedDate}"
                [panelOpen]="showPanel"                
                (changeGeoObject)="onChangeGeoObject($event)" (changeRelationship)="visualizingRelationship = $event">
              </relationship-visualizer>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Full screen map-->
    <div class="row">
      <div class="col-md-12">
        <div class="row">
          <article id="navigator-layer-panel" class="base-layer-panel"
            [ngClass]="{'second-map-button' : searchEnabled && !showPanel}"
            [ngStyle]="{'max-width': layersPanelSize === 2 ? '50%' : 'unset', 'padding-left': layersPanelSize === 2 ? '10px' : 'unset'}">
            <layer-panel (layerChange)="onLayerChange($event)" (reorder)="onReorderLayers($event)"
              (zoomTo)="onZoomTo($event.oid)" (create)="onCreate($event)" [panelSize]="layersPanelSize"
              [includeGraphLayer]="data != null && data.length > 0">
            </layer-panel>
          </article>

          <div id="map" class="map-view-port"></div>

        </div>
      </div>
    </div>
  </div>
</div>